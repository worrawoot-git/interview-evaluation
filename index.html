
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PizZip/3.1.5/pizzip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.11/docxtemplater.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h2 {
            color: #764ba2;
            font-size: 1.3em;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        input, select, textarea {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .criteria-container, .students-container {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .criteria-header {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: flex-end;
        }

        .criteria-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .criteria-column input {
            width: 100%;
        }

        .criteria-actions {
            display: flex;
            gap: 5px;
            align-items: flex-end;
        }

        .student-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .student-number {
            width: 50px;
            text-align: center;
            font-weight: bold;
        }

        .student-name-input {
            width: 250px;
        }

        .score-inputs {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        .score-inputs input {
            width: 80px;
            text-align: center;
        }

        .total-score {
            width: 100px;
        }

        .remove-student-btn {
            width: 50px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-add {
            background: #4CAF50;
            color: white;
        }

        .btn-add:hover {
            background: #45a049;
        }

        .btn-remove {
            background: #f44336;
            color: white;
            padding: 8px 12px;
        }

        .btn-remove:hover {
            background: #da190b;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #764ba2;
            color: white;
        }

        .btn-secondary:hover {
            background: #663d8f;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .total-score {
            font-weight: bold;
            color: #667eea;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            text-align: center;
        }

        #resultsSection {
            margin-top: 40px;
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        tr:hover {
            background: #f0f0f0;
        }

        .statistics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 1em;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        #chartContainer {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .hidden {
            display: none;
        }

        @media print {
            .btn, .action-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</h1>

        <div class="form-section">
            <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ *</label>
                    <select id="degreeLevel">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö --</option>
                        <option value="‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ</option>
                        <option value="‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó</option>
                        <option value="‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ *</label>
                    <input type="text" id="academicYear" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2567">
                </div>
                <div class="form-group">
                    <label>‡∏†‡∏≤‡∏Ñ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ *</label>
                    <select id="semester">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ --</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3 (‡∏†‡∏≤‡∏Ñ‡∏§‡∏î‡∏π‡∏£‡πâ‡∏≠‡∏ô)</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå *</label>
                    <input type="date" id="interviewDate">
                </div>
                <div class="form-group">
                    <label>‡πÄ‡∏ß‡∏•‡∏≤ *</label>
                    <input type="time" id="interviewTime">
                </div>
                <div class="form-group">
                    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå *</label>
                    <input type="text" id="location" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡πâ‡∏≠‡∏á 301 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ A">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ *</label>
                    <input type="text" id="program" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">
                </div>
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå *</label>
                    <input type="text" id="interviewer" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏®.‡∏î‡∏£.‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2>‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
            <div class="criteria-container">
                <div class="criteria-header" id="criteriaHeader">
                    <!-- Criteria columns will be added here -->
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-add" onclick="addCriteria()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå</button>
                    <strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalMaxScore">0</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
            <div class="students-container">
                <div id="studentHeader" style="display: flex; gap: 10px; padding: 10px; background: #667eea; color: white; border-radius: 8px; margin-bottom: 10px; font-weight: bold;">
                    <div style="width: 50px; text-align: center;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</div>
                    <div style="width: 250px;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>
                    <div id="criteriaHeaderLabels" style="display: flex; gap: 10px; flex: 1;"></div>
                    <div style="width: 100px; text-align: center;">‡∏£‡∏ß‡∏°</div>
                    <div style="width: 50px;"></div>
                </div>
                <div id="studentsContainer">
                    <!-- Student rows will be added here -->
                </div>
            </div>
            <button class="btn btn-add" onclick="addStudent()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</button>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="showResults()">üìä ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <button class="btn btn-warning" onclick="resetForm()">üîÑ Reset</button>
        </div>

        <div id="resultsSection">
            <div class="form-section">
                <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                <div id="resultsTable"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="downloadWord()">üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Word</button>
                    <button class="btn btn-success" onclick="downloadExcel()">üìä ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel</button>
                    <button class="btn btn-info" onclick="showAnalysis()">üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>

            <div id="analysisSection" class="hidden">
                <div class="form-section">
                    <h2>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
                    <div class="statistics" id="statisticsContainer"></div>
                    <div id="chartContainer">
                        <canvas id="scoreChart"></canvas>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="downloadChart()">üñºÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏≤‡∏ü (PNG)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let criteriaCount = 0;
        let studentCount = 0;
        let chart = null;

        // Initialize form with default criteria and students
        function init() {
            for (let i = 0; i < 5; i++) {
                addCriteria();
            }
            for (let i = 0; i < 5; i++) {
                addStudent();
            }
        }

        function addCriteria() {
            criteriaCount++;
            const container = document.getElementById('criteriaHeader');
            const div = document.createElement('div');
            div.className = 'criteria-column';
            div.id = `criteria-${criteriaCount}`;
            div.innerHTML = `
                <label>‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà ${criteriaCount}</label>
                <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå" id="criteriaName-${criteriaCount}" oninput="updateCriteriaHeaderLabels()">
                <input type="number" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°" id="criteriaMax-${criteriaCount}" min="0" oninput="updateTotalMaxScore()">
                <button class="btn btn-remove" onclick="removeCriteria(${criteriaCount})" style="padding: 8px;">-</button>
            `;
            container.appendChild(div);
            updateStudentsTable();
        }

        function removeCriteria(id) {
            const element = document.getElementById(`criteria-${id}`);
            if (element) {
                element.remove();
                updateTotalMaxScore();
                updateStudentsTable();
            }
        }

        function addStudent() {
            studentCount++;
            const container = document.getElementById('studentsContainer');
            const div = document.createElement('div');
            div.className = 'student-row';
            div.id = `student-${studentCount}`;
            div.innerHTML = `
                <div class="student-number">${studentCount}</div>
                <input type="text" class="student-name-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ô‡∏¥‡∏™‡∏¥‡∏ï" id="studentName-${studentCount}">
                <div class="score-inputs" id="scoreInputs-${studentCount}"></div>
                <div class="total-score" id="studentTotal-${studentCount}">0</div>
                <button class="btn btn-remove remove-student-btn" onclick="removeStudent(${studentCount})">-</button>
            `;
            container.appendChild(div);
            updateStudentScoreInputs(studentCount);
        }

        function removeStudent(id) {
            const element = document.getElementById(`student-${id}`);
            if (element) {
                element.remove();
                renumberStudents();
            }
        }

        function renumberStudents() {
            const container = document.getElementById('studentsContainer');
            const students = container.getElementsByClassName('student-row');
            Array.from(students).forEach((student, index) => {
                const numberDiv = student.querySelector('.student-number');
                numberDiv.textContent = index + 1;
            });
        }

        function updateStudentsTable() {
            // Update header labels
            updateCriteriaHeaderLabels();
            
            const students = document.querySelectorAll('.student-row');
            students.forEach(student => {
                const id = student.id.split('-')[1];
                updateStudentScoreInputs(id);
            });
        }

        function updateCriteriaHeaderLabels() {
            const container = document.getElementById('criteriaHeaderLabels');
            if (!container) return;
            
            container.innerHTML = '';
            const criteria = document.querySelectorAll('.criteria-column');
            
            criteria.forEach(criteriaItem => {
                const criteriaId = criteriaItem.id.split('-')[1];
                const criteriaName = document.getElementById(`criteriaName-${criteriaId}`).value || `‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå ${criteriaId}`;
                
                const label = document.createElement('div');
                label.style.width = '80px';
                label.style.textAlign = 'center';
                label.textContent = criteriaName;
                
                container.appendChild(label);
            });
        }

        function updateStudentScoreInputs(studentId) {
            const container = document.getElementById(`scoreInputs-${studentId}`);
            if (!container) return;

            container.innerHTML = '';
            const criteria = document.querySelectorAll('.criteria-column');
            
            criteria.forEach(criteriaItem => {
                const criteriaId = criteriaItem.id.split('-')[1];
                
                const input = document.createElement('input');
                input.type = 'number';
                input.placeholder = '0';
                input.min = '0';
                input.id = `score-${studentId}-${criteriaId}`;
                input.oninput = () => calculateStudentTotal(studentId);
                
                container.appendChild(input);
            });
        }

        function calculateStudentTotal(studentId) {
            const scoreInputs = document.querySelectorAll(`[id^="score-${studentId}-"]`);
            let total = 0;
            scoreInputs.forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            document.getElementById(`studentTotal-${studentId}`).textContent = total.toFixed(2);
        }

        function updateTotalMaxScore() {
            const criteria = document.querySelectorAll('.criteria-column');
            let total = 0;
            criteria.forEach(item => {
                const id = item.id.split('-')[1];
                const maxScore = parseFloat(document.getElementById(`criteriaMax-${id}`).value) || 0;
                total += maxScore;
            });
            document.getElementById('totalMaxScore').textContent = total.toFixed(2);
        }

        function showResults() {
            // Validate required fields
            const required = ['degreeLevel', 'academicYear', 'semester', 'interviewDate', 'interviewTime', 'location', 'program', 'interviewer'];
            for (let field of required) {
                if (!document.getElementById(field).value) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
            }

            const resultsTable = generateResultsTable();
            document.getElementById('resultsTable').innerHTML = resultsTable;
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('analysisSection').classList.add('hidden');
        }

        function generateResultsTable() {
            const degreeLevel = document.getElementById('degreeLevel').value;
            const academicYear = document.getElementById('academicYear').value;
            const semester = document.getElementById('semester').value;
            const interviewDate = document.getElementById('interviewDate').value;
            const interviewTime = document.getElementById('interviewTime').value;
            const location = document.getElementById('location').value;
            const program = document.getElementById('program').value;
            const interviewer = document.getElementById('interviewer').value;

            let html = `
                <div style="margin-bottom: 20px; padding: 20px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</h3>
                    <p><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</strong> ${degreeLevel}</p>
                    <p><strong>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</strong> ${academicYear} ‡∏†‡∏≤‡∏Ñ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${semester}</p>
                    <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå:</strong> ${formatDate(interviewDate)} ‡πÄ‡∏ß‡∏•‡∏≤ ${interviewTime} ‡∏ô.</p>
                    <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> ${location}</p>
                    <p><strong>‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£:</strong> ${program}</p>
                    <p><strong>‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå:</strong> ${interviewer}</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            `;

            // Add criteria headers
            const criteria = document.querySelectorAll('.criteria-column');
            criteria.forEach(item => {
                const id = item.id.split('-')[1];
                const name = document.getElementById(`criteriaName-${id}`).value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const max = document.getElementById(`criteriaMax-${id}`).value || '0';
                html += `<th>${name}<br>(${max})</th>`;
            });

            html += `
                            <th>‡∏£‡∏ß‡∏°</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Add student rows
            const students = document.querySelectorAll('.student-row');
            let rowNum = 1;
            students.forEach(student => {
                const studentId = student.id.split('-')[1];
                const name = document.getElementById(`studentName-${studentId}`).value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
                const total = document.getElementById(`studentTotal-${studentId}`).textContent;

                html += `
                    <tr>
                        <td>${rowNum++}</td>
                        <td>${name}</td>
                `;

                criteria.forEach(item => {
                    const criteriaId = item.id.split('-')[1];
                    const score = document.getElementById(`score-${studentId}-${criteriaId}`).value || '0';
                    html += `<td>${score}</td>`;
                });

                html += `
                        <td><strong>${total}</strong></td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            return html;
        }

        function formatDate(dateString) {
            try {
                if (!dateString) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('th-TH', options);
            } catch (error) {
                console.error('Error formatting date:', error);
                return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            }
        }

        function showAnalysis() {
            const students = document.querySelectorAll('.student-row');
            const scores = [];
            const names = [];

            students.forEach(student => {
                const studentId = student.id.split('-')[1];
                const name = document.getElementById(`studentName-${studentId}`).value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
                const total = parseFloat(document.getElementById(`studentTotal-${studentId}`).textContent);
                
                if (name && !isNaN(total)) {
                    names.push(name);
                    scores.push(total);
                }
            });

            if (scores.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå');
                return;
            }

            // Calculate statistics
            const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
            const max = Math.max(...scores);
            const min = Math.min(...scores);
            const maxScore = parseFloat(document.getElementById('totalMaxScore').textContent);

            // Display statistics
            const statsHtml = `
                <div class="stat-card">
                    <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</h3>
                    <div class="value">${scores.length}</div>
                </div>
                <div class="stat-card">
                    <h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</h3>
                    <div class="value">${avg.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
                    <div class="value">${max.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</h3>
                    <div class="value">${min.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°</h3>
                    <div class="value">${maxScore}</div>
                </div>
            `;
            document.getElementById('statisticsContainer').innerHTML = statsHtml;

            // Create chart
            createChart(names, scores);

            document.getElementById('analysisSection').classList.remove('hidden');
        }

        function createChart(names, scores) {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: names,
                    datasets: [{
                        label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ',
                        data: scores,
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: '‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå',
                            font: {
                                size: 18
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡∏ô‡∏¥‡∏™‡∏¥‡∏ï'
                            }
                        }
                    }
                }
            });
        }

        function downloadChart() {
            const canvas = document.getElementById('scoreChart');
            canvas.toBlob(function(blob) {
                saveAs(blob, 'interview_chart.png');
            });
        }

        function downloadExcel() {
            try {
                // Validate that results have been shown
                if (document.getElementById('resultsSection').style.display === 'none') {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
                    return;
                }

                const wb = XLSX.utils.book_new();
                
                // Create header data
                const interviewDateValue = document.getElementById('interviewDate').value;
                const formattedDate = interviewDateValue ? formatDate(interviewDateValue) : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                
                const headerData = [
                    ['‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ô‡∏¥‡∏™‡∏¥‡∏ï'],
                    [''],
                    ['‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:', document.getElementById('degreeLevel').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'],
                    ['‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:', document.getElementById('academicYear').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏', '‡∏†‡∏≤‡∏Ñ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:', document.getElementById('semester').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'],
                    ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå:', formattedDate, '‡πÄ‡∏ß‡∏•‡∏≤:', document.getElementById('interviewTime').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'],
                    ['‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:', document.getElementById('location').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'],
                    ['‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£:', document.getElementById('program').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'],
                    ['‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå:', document.getElementById('interviewer').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'],
                    [''],
                ];

                // Create table headers
                const tableHeaders = ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'];
                const criteria = document.querySelectorAll('.criteria-column');
                criteria.forEach(item => {
                    const id = item.id.split('-')[1];
                    const name = document.getElementById(`criteriaName-${id}`).value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    const max = document.getElementById(`criteriaMax-${id}`).value || '0';
                    tableHeaders.push(`${name} (${max})`);
                });
                tableHeaders.push('‡∏£‡∏ß‡∏°');

                const data = [tableHeaders];

                // Add student data
                const students = document.querySelectorAll('.student-row');
                let rowNum = 1;
                students.forEach(student => {
                    const studentId = student.id.split('-')[1];
                    const name = document.getElementById(`studentName-${studentId}`).value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
                    const total = document.getElementById(`studentTotal-${studentId}`).textContent || '0';

                    const row = [rowNum++, name];

                    criteria.forEach(item => {
                        const criteriaId = item.id.split('-')[1];
                        const score = parseFloat(document.getElementById(`score-${studentId}-${criteriaId}`).value) || 0;
                        row.push(score);
                    });

                    row.push(parseFloat(total));
                    data.push(row);
                });

                const allData = [...headerData, ...data];
                const ws = XLSX.utils.aoa_to_sheet(allData);
                
                // Set column widths
                ws['!cols'] = [
                    { wch: 8 },
                    { wch: 30 },
                    ...Array(criteria.length).fill({ wch: 15 }),
                    { wch: 10 }
                ];

                XLSX.utils.book_append_sheet(wb, ws, '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå');
                XLSX.writeFile(wb, 'interview_results.xlsx');
                
                // Show success message
                setTimeout(() => {
                    alert('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå Downloads');
                }, 100);
                
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel: ' + error.message);
                console.error('Download Excel Error:', error);
            }
        }

        function downloadWord() {
            try {
                // Validate that results have been shown
                if (document.getElementById('resultsSection').style.display === 'none') {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
                    return;
                }

                // Get form data with validation
                const degreeLevel = document.getElementById('degreeLevel').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const academicYear = document.getElementById('academicYear').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const semester = document.getElementById('semester').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const interviewDateValue = document.getElementById('interviewDate').value;
                const interviewDate = interviewDateValue ? formatDate(interviewDateValue) : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const interviewTime = document.getElementById('interviewTime').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const location = document.getElementById('location').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const program = document.getElementById('program').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const interviewer = document.getElementById('interviewer').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

                // Build criteria headers
                const criteria = document.querySelectorAll('.criteria-column');
                let criteriaHeaders = '';
                criteria.forEach(item => {
                    const id = item.id.split('-')[1];
                    const name = document.getElementById(`criteriaName-${id}`).value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    const max = document.getElementById(`criteriaMax-${id}`).value || '0';
                    criteriaHeaders += `<th style="border: 1px solid #000; padding: 8px; background: #667eea; color: white;">${name}<br/>(${max})</th>`;
                });

                // Build student rows
                const students = document.querySelectorAll('.student-row');
                let studentRows = '';
                let rowNum = 1;
                students.forEach(student => {
                    const studentId = student.id.split('-')[1];
                    const name = document.getElementById(`studentName-${studentId}`).value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
                    const total = document.getElementById(`studentTotal-${studentId}`).textContent || '0';

                    studentRows += `<tr>`;
                    studentRows += `<td style="border: 1px solid #000; padding: 8px; text-align: center;">${rowNum++}</td>`;
                    studentRows += `<td style="border: 1px solid #000; padding: 8px;">${name}</td>`;

                    criteria.forEach(item => {
                        const criteriaId = item.id.split('-')[1];
                        const score = document.getElementById(`score-${studentId}-${criteriaId}`).value || '0';
                        studentRows += `<td style="border: 1px solid #000; padding: 8px; text-align: center;">${score}</td>`;
                    });

                    studentRows += `<td style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: bold;">${total}</td>`;
                    studentRows += `</tr>`;
                });

                let content = `
                    <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                          xmlns:w='urn:schemas-microsoft-com:office:word' 
                          xmlns='http://www.w3.org/TR/REC-html40'>
                    <head>
                        <meta charset='utf-8'>
                        <title>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</title>
                        <style>
                            body { font-family: 'Sarabun', 'Cordia New', 'TH SarabunPSK', sans-serif; }
                            h1 { text-align: center; color: #667eea; margin-bottom: 20px; }
                            .info-section { margin: 20px 0; padding: 15px; background: #f5f5f5; }
                            .info-section p { margin: 5px 0; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th { background: #667eea; color: white; font-weight: bold; }
                            td, th { border: 1px solid #000; padding: 8px; }
                            tr:nth-child(even) { background: #f9f9f9; }
                        </style>
                    </head>
                    <body>
                        <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</h1>
                        
                        <div class="info-section">
                            <h3 style="color: #667eea; margin-bottom: 10px;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</h3>
                            <p><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</strong> ${degreeLevel}</p>
                            <p><strong>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</strong> ${academicYear} ‡∏†‡∏≤‡∏Ñ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${semester}</p>
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå:</strong> ${interviewDate} ‡πÄ‡∏ß‡∏•‡∏≤ ${interviewTime} ‡∏ô.</p>
                            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> ${location}</p>
                            <p><strong>‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£:</strong> ${program}</p>
                            <p><strong>‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå:</strong> ${interviewer}</p>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #000; padding: 8px; background: #667eea; color: white;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                    <th style="border: 1px solid #000; padding: 8px; background: #667eea; color: white;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    ${criteriaHeaders}
                                    <th style="border: 1px solid #000; padding: 8px; background: #667eea; color: white;">‡∏£‡∏ß‡∏°</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${studentRows}
                            </tbody>
                        </table>
                    </body>
                    </html>
                `;

                const blob = new Blob(['\ufeff', content], {
                    type: 'application/msword'
                });

                saveAs(blob, 'interview_results.doc');
                
                // Show success message
                setTimeout(() => {
                    alert('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Word ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå Downloads');
                }, 100);
                
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Word: ' + error.message);
                console.error('Download Word Error:', error);
            }
        }

        function resetForm() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                location.reload();
            }
        }

        // Initialize on page load
        window.onload = init;
    </script>
</body>
</html>
